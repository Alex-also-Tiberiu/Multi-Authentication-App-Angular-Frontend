<div class="register-container">
  <div class="register-card">
    <h1>Registrati</h1>
    
    @if (errorMessage()) {
      <div class="alert alert-error">
        {{ errorMessage() }}
      </div>
    }

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="firstname">Nome</label>
          <input
            id="firstname"
            type="text"
            formControlName="firstname"
            placeholder="Inserisci il tuo nome"
            [attr.aria-invalid]="isFieldInvalid('firstname')"
            [attr.aria-describedby]="isFieldInvalid('firstname') ? 'firstname-error' : null"
            [disabled]="authService.isLoading()"
          />
          @if (isFieldInvalid('firstname')) {
            <span id="firstname-error" class="error-text">
              Nome è obbligatorio
            </span>
          }
        </div>

        <div class="form-group">
          <label for="lastname">Cognome</label>
          <input
            id="lastname"
            type="text"
            formControlName="lastname"
            placeholder="Inserisci il tuo cognome"
            [attr.aria-invalid]="isFieldInvalid('lastname')"
            [attr.aria-describedby]="isFieldInvalid('lastname') ? 'lastname-error' : null"
            [disabled]="authService.isLoading()"
          />
          @if (isFieldInvalid('lastname')) {
            <span id="lastname-error" class="error-text">
              Cognome è obbligatorio
            </span>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          placeholder="Inserisci la tua email"
          [attr.aria-invalid]="isFieldInvalid('email')"
          [attr.aria-describedby]="isFieldInvalid('email') ? 'email-error' : null"
          [disabled]="authService.isLoading()"
        />
        @if (isFieldInvalid('email')) {
          <span id="email-error" class="error-text">
            Email valida è obbligatoria
          </span>
        }
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          placeholder="Inserisci una password sicura"
          [attr.aria-invalid]="isFieldInvalid('password')"
          [attr.aria-describedby]="isFieldInvalid('password') ? 'password-error' : null"
          [disabled]="authService.isLoading()"
        />
        @if (isFieldInvalid('password')) {
          <span id="password-error" class="error-text">
            Password è obbligatoria (minimo 6 caratteri)
          </span>
        }
      </div>

      <div class="form-group">
        <label for="role">Ruolo</label>
        <select
          id="role"
          formControlName="role"
          [attr.aria-invalid]="isFieldInvalid('role')"
          [attr.aria-describedby]="isFieldInvalid('role') ? 'role-error' : null"
          [disabled]="authService.isLoading()"
        >
          <option value="">Seleziona un ruolo</option>
          <option value="USER">Utente</option>
          <option value="ADMIN">Amministratore</option>
        </select>
        @if (isFieldInvalid('role')) {
          <span id="role-error" class="error-text">
            Ruolo è obbligatorio
          </span>
        }
      </div>

      <button
        type="submit"
        [disabled]="!registerForm.valid || authService.isLoading()"
        class="btn btn-primary"
      >
        @if (authService.isLoading()) {
          <span>Registrazione in corso...</span>
        } @else {
          <span>Registrati</span>
        }
      </button>
    </form>

    <div class="login-link">
      <p>Hai già un account? <a [routerLink]="['/login']">Accedi qui</a></p>
    </div>
  </div>
</div>
